{
  "name": "[PolicyInsight] Queue Backlog > 50 Jobs",
  "type": "metric alert",
  "query": "avg(last_5m):avg:policyinsight.job.backlog{service:policy-insight} > 50",
  "message": "Queue backlog has exceeded 50 pending jobs for the last 5 minutes.\n\nThis may indicate:\n- Worker instances are slow or crashed\n- Gemini API quota/throttling\n- Database connection issues\n\nCheck:\n- Worker pod logs (Cloud Run)\n- Gemini API quota status\n- Worker crash logs\n\n@on-call-engineering",
  "tags": [
    "service:policy-insight",
    "alert_type:backlog",
    "severity:medium"
  ],
  "options": {
    "thresholds": {
      "critical": 50,
      "warning": 30
    },
    "notify_audit": false,
    "require_full_window": false,
    "notify_no_data": false,
    "renotify_interval": 60,
    "escalation_message": "Queue backlog still elevated after 1 hour. Consider scaling workers or investigating bottleneck.",
    "no_data_timeframe": 10
  },
  "priority": 2,
  "incident_setting": {
    "create_incident": true,
    "incident_title": "[PolicyInsight] Job Queue Backlog (50+ jobs)",
    "incident_severity": "medium",
    "incident_notification_handles": ["@on-call-engineering"]
  }
}

